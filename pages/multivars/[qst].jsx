import axios from "axios";
import { Card, Title, Text, Grid } from "@tremor/react";
import ScatterChartExample from "@/components/Qsts/FullQuestion3";
import Question from "@/components/Qsts/FullQuestions2";
import Question2 from "@/components/Qsts/FullQeuestion1";
import { MultiSelect, MultiSelectItem } from "@tremor/react";
import { CalculatorIcon } from "@heroicons/react/outline";
import { useState, useEffect } from "react";
import { Form, Formik } from "formik";
import FormikControl from "@/components/formComponents/ControlComponents/FormikControl";
import * as Yup from "yup";
import dynamic from 'next/dynamic';

const DynamicBiplotComponent = dynamic(() => import('../../components/multivars/BiplotComponent'), {
  ssr: false, // Render only on the client side
});

export default function Example() {
  const list_items = [];


  const options = [
    { key: "Donator", value: true },
    { key: "Requester", value: false },
  ];

  const initialValues = {
    isDonator: true,
  };

  const validationSchema = Yup.object({
    isDonator: Yup.string(),
  });

  const onSubmit = async (values) => {
    console.log("Form data", values);
  };


  const [data, setData] = useState([]);
  const [variance, setVariance] = useState([])
  const [loadings,setLoadings]=useState([])
  const [pcaRes,setPcaRes]=useState([])
  useEffect(() => {
    const getData = async () => {
      try {
        let results = await axios.get("http://127.0.0.1:5000/PCA", {
          headers: {
            "Cache-Control": "no-cache",
            "Access-Control-Allow-Origin": "*",
          },
        });
        setData( results.data["pca_result"]);
        setVariance(results.data['explained_variance_ratio'])
        const convertedArray=(results.data["pca_result"]).map(obj => [obj.val1, obj.val2, obj.val3])
        setLoadings(results.data["loadings"])
        setPcaRes(convertedArray)
      } catch (error) {
        console.log(error);
      }
    };

    getData();
}, []);

const data3 = {
  "loadings":[[-0.1997534039008589,0.9877174227144953,0.03434439055976765],[-0.9323439849692684,-0.061032480778635385,-0.37904669454870127],[0.9234271156174289,0.15203869213199106,-0.37527758380155846]],"pca_result":[[3.252835721255845,-0.20166747372571345,3.670194537054562],[-0.19834672500258954,-0.4814539588811086,-0.11705066221436045],[-0.5624191780087411,1.8866891229038427,0.03748437015354833],[-0.1905177836677384,-0.4792399779398018,-0.13270645874101059],[-0.37838259646759254,0.7029183514321217,-0.03971596866328345],[-0.19405246208241175,-0.4801507595351355,-0.12700149189580187],[-0.7403203260602097,3.07141617091387,0.11437235567452682],[-0.1283793945587348,-0.46606519482944037,-0.18944955368380884],[-0.09458204061854851,-0.4609766120771404,-0.18842016959002614],[-0.19964036968355628,-0.48050695097110774,-0.13462000226045948],[-0.3658018791853816,0.7061693811883685,-0.06016482583408082],[-0.3729534315923634,0.7044701084139958,-0.05082494185760327],[-0.23974747120859638,-0.513810141525429,0.2827560229590233],[-0.18296247265425195,-0.4806539602994293,-0.09330243903100986],[0.034499851159520076,-0.43613088464640304,-0.267563866509082],[-0.37901353019089035,0.7028343368399056,-0.03990375960194656],[-0.11107062151245511,-0.46315419653783346,-0.19360450227734202],[-0.7508057045841631,3.070520041067789,0.10357346899773345],[-0.2387484346314752,-0.5136260096168618,0.2822688136266849],[0.14051391853713555,-0.4217932191076798,-0.2394017403790274],[-0.33011860561203393,1.9399535343905239,-0.23623216303973527],[-0.150579243162787,-0.47647608810688136,-0.08160273047742689],[-0.6451551137822765,1.8560612383395312,0.31394705719292454],[-0.20074429110016823,-0.48127434692438853,-0.12542349705072708],[-0.47498788822127885,1.9036114638930712,-0.017558255790345985],[-0.019998007129143968,-0.4488913831888518,-0.19928682302347653],[9.49711174915333,1.06822555884849,-1.2022456152642167],[-0.19528900431539872,-0.4801811202252408,-0.12943140614625004],[-0.5017709022517285,1.8999619248947588,-0.024253546943504744],[-0.10550595702879163,-0.4678963846948613,-0.10776423061972587],[-0.04280525206473528,-0.45524409303469004,-0.15516846167593],[-0.75119917026036,3.070530176095619,0.1024963471918121],[-0.19588137219500223,-0.480085676923321,-0.13228411822606825],[0.038545121700051074,-0.4281289982708326,-0.38094381089667434],[-0.2017863844463498,-0.4827123021088159,-0.10578698933003068],[-0.23452688352838647,-0.5099616203369788,0.23589598062908698],[-0.2409863461514101,-0.5139972837187068,0.2827277356613254],[-0.02123703966376569,-0.44893983432896684,-0.20144482425807567],[-0.1998510168557045,-0.4824040800427891,-0.10598643755902531],[-0.2409123723085798,-0.5139438350043338,0.282080380021106],[-0.03758807311211731,-0.45505601308495325,-0.1458371759494503],[-0.14826376569704838,-0.46986462872792345,-0.17768650335797886],[-0.24004364539626097,-0.5139035719650057,0.28349681928915926],[-0.19959316666085675,-0.4805230132539074,-0.13426284364130361],[-0.09211596469807332,-0.4575762684621411,-0.23485048394622077],[-0.23480833448044156,-0.5086771808823354,0.21551661334229325],[-0.23741649233634624,-0.5088839149426799,0.2125821908034969],[-0.27757951728243113,-0.5200944292513228,0.29063501943682335],[-0.20331385438197833,-0.481388506930355,-0.12968883262664332],[0.041491527616259814,-0.4346348737963334,-0.27415747705686283],[-0.2084995831456116,-0.5086263933433124,0.27635333537311096],[-0.19443288010670562,-0.4798740279628904,-0.1321411527426037],[0.0430541304352601,-0.42785002341233025,-0.3746666202060347],[-0.24040319485378517,-0.5139244913459915,0.282975914105432],[-0.2035308844452999,-0.48154727883017134,-0.12775947923590225],[-0.01387577255508592,-0.4476965007391061,-0.20329344174495112],[0.0007041581202902742,-0.4769886204579621,0.2805798904688553],[-0.1801524898260925,-0.47690863085348795,-0.14422392540351603],[-0.04313441148330987,-0.45545610907977674,-0.1526842556301108],[-0.1943195160181629,-0.47982141047606897,-0.13268349240522873],[-0.018605359710482716,-0.4546991348210905,-0.10685787519464318]]
};

const variableLabels = ['Var1', 'Var2', 'Var3'];

  const chartdata = [
    {
      Country: "Argentina",
      Life_expectancy: 76.3,
      GDP: 13467.1236,
      Population: 43417765,
    },
    {
      Country: "Australia",
      Life_expectancy: 82.8,
      GDP: 56554.3876,
      Population: 23789338,
    },
    {
      Country: "Austria",
      Life_expectancy: 81.5,
      GDP: 43665.947,
      Population: 8633169,
    },
    // ...
  ];

  const vars = [
    { key: "variable1", value: "variable1" },
    { key: "variable2", value: "variable2" },
    { key: "variable3", value: "variable3" },
    { key: "variable4", value: "variable4" },
    { key: "variable5", value: "variable5" },
    { key: "variable6", value: "variable6" },
    { key: "variable7", value: "variable7" },
    { key: "variable8", value: "variable8" },
    { key: "variable9", value: "variable9" },
    { key: "variable11", value: "variable11" },
    { key: "variable12", value: "variable12" },
    { key: "variable13", value: "variable13" },
    { key: "variable14", value: "variable94" },
    { key: "variable15", value: "variable15" },
  ];

  const data2 = [
    {
      val1: 3.2528357212558454,
      val2: -0.20166747372571964,
      val3: 3.670194537054562
    },
    {
      val1: -0.19834672500258818,
      val2: -0.4814539588811085,
      val3: -0.11705066221436006
    },
    {
      val1: -0.5624191780087385,
      val2: 1.8866891229038447,
      val3: 0.037484370153548024
    },
    {
      val1: -0.1905177836677391,
      val2: -0.47923997793980194,
      val3: -0.1327064587410104
    },
    {
      val1: -0.3783825964675916,
      val2: 0.7029183514321227,
      val3: -0.03971596866328354
    },
    {
      val1: -0.19405246208241247,
      val2: -0.48015075953513575,
      val3: -0.1270014918958017
    },
    {
      val1: -0.7403203260602051,
      val2: 3.0714161709138725,
      val3: 0.11437235567452637
    },
    {
      val1: -0.12837939455873548,
      val2: -0.46606519482944064,
      val3: -0.1894495536838087
    },
    {
      val1: -0.09458204061854925,
      val2: -0.4609766120771408,
      val3: -0.188420169590026
    },
    {
      val1: -0.19964036968355695,
      val2: -0.48050695097110796,
      val3: -0.13462000226045934
    },
    {
      val1: -0.3658018791853806,
      val2: 0.7061693811883695,
      val3: -0.06016482583408087
    },
    {
      val1: -0.3729534315923624,
      val2: 0.7044701084139968,
      val3: -0.05082494185760335
    },
    {
      val1: -0.2397474712085972,
      val2: -0.5138101415254293,
      val3: 0.28275602295902325
    },
    {
      val1: -0.18296247265425258,
      val2: -0.48065396029942953,
      val3: -0.09330243903100972
    },
    {
      val1: 0.034499851159519535,
      val2: -0.4361308846464034,
      val3: -0.2675638665090818
    },
    {
      val1: -0.37901353019088935,
      val2: 0.7028343368399066,
      val3: -0.039903759601946635
    },
    {
      val1: -0.11107062151245585,
      val2: -0.4631541965378337,
      val3: -0.19360450227734188
    },
    {
      val1: -0.7508057045841587,
      val2: 3.070520041067792,
      val3: 0.10357346899773295
    },
    {
      val1: -0.23874843463147596,
      val2: -0.5136260096168621,
      val3: 0.2822688136266849
    },
    {
      val1: 0.14051391853713502,
      val2: -0.42179321910768036,
      val3: -0.23940174037902726
    },
    {
      val1: -0.3301186056120312,
      val2: 1.9399535343905259,
      val3: -0.23623216303973532
    },
    {
      val1: -0.15057924316278778,
      val2: -0.4764760881068816,
      val3: -0.08160273047742678
    },
    {
      val1: -0.6451551137822736,
      val2: 1.8560612383395338,
      val3: 0.31394705719292415
    },
    {
      val1: -0.20074429110016886,
      val2: -0.48127434692438864,
      val3: -0.12542349705072695
    },
    {
      val1: -0.474987888221276,
      val2: 1.9036114638930737,
      val3: -0.017558255790346235
    },
    {
      val1: -0.019998007129144683,
      val2: -0.44889138318885224,
      val3: -0.19928682302347636
    },
    {
      val1: 9.497111749153335,
      val2: 1.0682255588484801,
      val3: -1.2022456152642165
    },
    {
      val1: -0.1952890043153994,
      val2: -0.4801811202252409,
      val3: -0.12943140614624984
    },
    {
      val1: -0.5017709022517255,
      val2: 1.8999619248947612,
      val3: -0.02425354694350494
    },
    {
      val1: -0.10550595702879235,
      val2: -0.4678963846948616,
      val3: -0.10776423061972576
    },
    {
      val1: -0.04280525206473593,
      val2: -0.45524409303469043,
      val3: -0.15516846167592982
    },
    {
      val1: -0.7511991702603557,
      val2: 3.070530176095622,
      val3: 0.1024963471918116
    },
    {
      val1: -0.19588137219500298,
      val2: -0.4800856769233212,
      val3: -0.13228411822606811
    },
    {
      val1: 0.03854512170005052,
      val2: -0.42812899827083295,
      val3: -0.3809438108966741
    },
    {
      val1: -0.20178638444635047,
      val2: -0.48271230210881605,
      val3: -0.10578698933003063
    },
    {
      val1: -0.23452688352838733,
      val2: -0.5099616203369791,
      val3: 0.23589598062908695
    },
    {
      val1: -0.24098634615141082,
      val2: -0.5139972837187069,
      val3: 0.28272773566132536
    },
    {
      val1: -0.02123703966376637,
      val2: -0.44893983432896717,
      val3: -0.20144482425807553
    },
    {
      val1: -0.1998510168557053,
      val2: -0.48240408004278934,
      val3: -0.10598643755902522
    },
    {
      val1: -0.2409123723085806,
      val2: -0.513943835004334,
      val3: 0.2820803800211061
    },
    {
      val1: -0.03758807311211794,
      val2: -0.45505601308495364,
      val3: -0.1458371759494502
    },
    {
      val1: -0.14826376569704913,
      val2: -0.4698646287279237,
      val3: -0.17768650335797875
    },
    {
      val1: -0.24004364539626175,
      val2: -0.5139035719650059,
      val3: 0.2834968192891592
    },
    {
      val1: -0.1995931666608575,
      val2: -0.4805230132539076,
      val3: -0.13426284364130353
    },
    {
      val1: -0.09211596469807405,
      val2: -0.45757626846214144,
      val3: -0.2348504839462206
    },
    {
      val1: -0.23480833448044244,
      val2: -0.5086771808823356,
      val3: 0.21551661334229327
    },
    {
      val1: -0.23741649233634698,
      val2: -0.5088839149426801,
      val3: 0.21258219080349688
    },
    {
      val1: -0.2775795172824319,
      val2: -0.520094429251323,
      val3: 0.29063501943682335
    },
    {
      val1: -0.20331385438197908,
      val2: -0.48138850693035523,
      val3: -0.12968883262664324
    },
    {
      val1: 0.0414915276162593,
      val2: -0.4346348737963338,
      val3: -0.27415747705686283
    },
    {
      val1: -0.20849958314561245,
      val2: -0.5086263933433127,
      val3: 0.27635333537311096
    },
    {
      val1: -0.19443288010670637,
      val2: -0.47987402796289064,
      val3: -0.13214115274260363
    },
    {
      val1: 0.043054130435259685,
      val2: -0.4278500234123306,
      val3: -0.3746666202060344
    },
    {
      val1: -0.240403194853786,
      val2: -0.5139244913459917,
      val3: 0.2829759141054319
    },
    {
      val1: -0.20353088444530068,
      val2: -0.48154727883017145,
      val3: -0.12775947923590214
    },
    {
      val1: -0.013875772555086614,
      val2: -0.4476965007391065,
      val3: -0.20329344174495098
    },
    {
      val1: 0.0007041581202895416,
      val2: -0.47698862045796253,
      val3: 0.2805798904688552
    },
    {
      val1: -0.18015248982609322,
      val2: -0.47690863085348806,
      val3: -0.14422392540351583
    },
    {
      val1: -0.043134411483310584,
      val2: -0.4554561090797771,
      val3: -0.1526842556301107
    },
    {
      val1: -0.1943195160181637,
      val2: -0.4798214104760691,
      val3: -0.13268349240522861
    },
    {
      val1: -0.018605359710483382,
      val2: -0.45469913482109087,
      val3: -0.10685787519464311
    }
  ]
  

  return (
    <main className=" py-20 px-20 lg:px-[180px]">
      <Title>Dashboard</Title>
      <Text>Lorem ipsum dolor sit amet, consetetur sadipscing elitr.</Text>

      {/* Main section */}
      <Card className="mt-6 ">
        <div className="max-w-sm mx-auto space-y-6 mb-6 ">
          <Formik
            initialValues={initialValues}
            validationSchema={validationSchema}
            onSubmit={onSubmit}
          >
            {(formik) => {
              return (
                <Form className="">
                  <FormikControl
                    control="select"
                    label="Variables à sélectionner"
                    name="isDonator"
                    options={vars}
                  />
                  {/* <div className="form-control mt-6 md:mt-12">
                  <button
                    className={`btn btn-primary bg-red-500`}
                    type="submit"
                    disabled={!formik.isValid}
                  >
                    Submit
                  </button>
                </div> */}
                </Form>
              );
            }}
          </Formik>
          {/* <MultiSelect
          placeholder={'select variales'}
            value={value}
            onValueChange={(values) => {
              setValue(values);
              alert(values);
            }}
          >
            <MultiSelectItem value={"1"} icon={CalculatorIcon}>
              Kilometers
            </MultiSelectItem>
            <MultiSelectItem value={"2"} icon={CalculatorIcon}>
              Meters
            </MultiSelectItem>
            <MultiSelectItem value={"3"} icon={CalculatorIcon}>
              Miles
            </MultiSelectItem>
            <MultiSelectItem value={"4"} icon={CalculatorIcon}>
              Nautical Miles
            </MultiSelectItem>
          </MultiSelect> */}
        </div>{" "}
        <Card className="bg-gray2 w-full mb-8">
          <ul className="flex flex-wrap gap-4">
            {vars.map((variable, index) => (
              <li
                key={index}
                className={`font-poppins font-normal text-[16px] leading-[24px] text-white bg-bleu1 rounded-xl w-fit px-4 py-2 mr-2`}
              >
                {variable.value}{" "}
              </li>
            ))}
          </ul>
        </Card>
        {/* <Card className="bg-gray1 w-full">
          {list_items.length === 0 ? (
            <div className="h-28" />
          ) : (
            list_items?.map((item, index) => {
              <div key={index}>item.value</div>;
            })
          )}
        </Card> */}
      </Card>
      <Card className="mt-6">
        <ScatterChartExample chartdata={data} />
      </Card>

      {/* KPI section */}
      <Grid numItemsMd={2} className="mt-6 gap-6">
        <Card>
          {/* Placeholder to set height */}
          <Question chartdata={variance} />
        </Card>
        <Card>
          {/* Placeholder to set height */}
           <DynamicBiplotComponent pcaResult={pcaRes} loadings={loadings} variableLabels={variableLabels} />
        </Card>
      </Grid>
    </main>
  );
}
